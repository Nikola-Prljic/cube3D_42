#!/bin/sh
num=0
count=0
cd ..
make
mv cub3D tester
make clean
cd tester
> out
echo "\n#############################"
echo "##### Cube Input Tester #####"
echo "#############################\n"
ft_test()
{
    count=$((count+1))
    ./cub3D $1 >> out 2>&1
    valgrind ./cub3D $1 > valgrind_test.txt 2>&1
    grep -q "ERROR SUMMARY: 0 errors" valgrind_test.txt
    val_error=$?
    grep -q "All heap blocks were freed -- no leaks are possible" valgrind_test.txt
    val_blocks=$?
    num=$(($num + $val_error + $val_blocks))
    if [ $num -ne 0 ]
        then echo valgrind error @ $1
    else
        echo -n "$count ok | "
    fi
}

ft_test
ft_test empty.cub
ft_test hi.cub
ft_test t1.cub
ft_test t2.cub
ft_test t3.cub
ft_test t4.cub
ft_test t5.cub
ft_test t6.cub
ft_test t7.cub
ft_test t8.cub
ft_test t9.cub
ft_test t10.cub

if [ $num -eq 0 ]
    then echo -n "valgrind: ok | "
else
    echo -n "valgrind: ko"
fi

diff out in

if [ $? -eq 0 ]
    then echo -n "tests:    ok\n"
    rm out valgrind_test.txt
else
    echo ko
fi